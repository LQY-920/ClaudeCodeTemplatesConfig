# 任务执行流程

本规则始终加载，定义 Claude 执行任务的标准流程。

---

## 1. 检索优先

回答问题或执行任务前，必须先全面检索相关代码/文件：

```
✅ 正确做法：
1. 先 Glob 搜索相关文件
2. 再 Read 阅读关键文件
3. 最后开始回答/编码

❌ 错误做法：
直接开始编码，假设代码结构
```

---

## 2. 需求澄清

通过多角度、多维度的提问引导用户明确需求：

- **功能边界**：这个功能包含哪些子功能？
- **异常场景**：如果 XX 情况发生，应该如何处理？
- **性能要求**：是否有性能指标要求？
- **兼容性**：需要支持哪些浏览器/设备？

---

## 3. 精准定位

基于检索结果，精准定位需改动的代码部分：

```
✅ 修改前确认：
- 哪些文件需要修改？
- 每个文件的修改点在哪里？
- 是否会影响其他功能？

❌ 避免：
- 大范围重构（除非明确要求）
- 修改不相关的代码
- 引入新的依赖（除非必要）
```

---

## 4. 信息充分性判断

评估当前信息是否足够，必要时向用户提问：

| 信息类型 | 判断标准 | 行动 |
|----------|----------|------|
| 业务逻辑 | 是否清晰理解需求 | 不清楚则询问 |
| 技术方案 | 是否有多种可选方案 | 有则列出让用户选择 |
| 影响范围 | 是否会影响现有功能 | 不确定则先确认 |

---

## 5. 方案讲解

对修改计划进行详略得当的讲解：

```markdown
## 修改方案

### 涉及文件
- `apps/server/src/modules/user/user.service.ts` - 新增 XX 方法
- `apps/server/src/modules/user/user.controller.ts` - 新增 XX 接口

### 实现思路
1. 首先...
2. 然后...
3. 最后...

### 伪代码
```typescript
async function xxx() {
  // Step 1: 获取数据
  // Step 2: 处理逻辑
  // Step 3: 返回结果
}
```
```

---

## 6. 实施与验证

- 按计划逐步实施修改
- 每完成一个关键步骤，进行验证
- 如有偏差，及时调整方案
- 完成后总结修改内容

---

## 7. 文档更新

如果修改涉及以下内容，需同步更新文档：

- API 接口变更 → 更新 Swagger 注释
- 配置项变更 → 更新 README 或配置说明
- 数据库变更 → 更新数据库设计文档
