---
name: review
description: "代码审查与重构。触发词：审查代码、review、检查质量、重构、代码优化..."
allowed-tools: Read, Grep, Glob, Bash(eslint*), Bash(tsc*), Bash(pnpm lint*)
---

# 代码审查技能

专用于代码审查、质量检查和重构建议。

---

## 触发场景

- 审查代码、review、检查质量
- 重构、代码精简、优化设计
- 代码评审、质量检测

---

## 审查流程

### 1. 静态分析

```bash
# 服务端（NestJS）
cd apps/server
npx eslint src/ --ext .ts --fix
npx tsc --noEmit

# 管理后台（Vue 3）
cd apps/admin
pnpm lint --fix
pnpm exec tsc -b --noEmit

# 小程序（使用微信开发者工具检查）
```

### 2. 重构检测

| 条件 | 阈值 | 处理方式 |
|------|------|----------|
| 函数行数 | > 80 行 | 拆分为多个小函数 |
| 嵌套深度 | > 3 层 | 使用 Early Return |
| 重复代码 | > 3 次 | 抽取公共函数/组件 |
| 参数数量 | > 5 个 | 使用对象参数 |
| 圈复杂度 | > 10 | 拆分逻辑 |

### 3. 架构检查

#### 服务端
- [ ] Controller 是否只做请求处理
- [ ] Service 是否包含业务逻辑
- [ ] DTO 是否有完整验证
- [ ] 异常是否正确处理
- [ ] 是否有 N+1 查询问题

#### 管理后台
- [ ] 组件是否符合单一职责
- [ ] 是否有 any 类型
- [ ] API 调用是否统一封装
- [ ] 是否有未处理的异常
- [ ] 是否有内存泄漏风险

#### 小程序
- [ ] setData 数据量是否合理
- [ ] 是否有性能问题
- [ ] 用户输入是否验证
- [ ] 错误处理是否完善

### 4. 安全检查

- [ ] 是否有硬编码的敏感信息
- [ ] 是否有 SQL 注入风险
- [ ] 是否有 XSS 风险
- [ ] 权限验证是否完整

---

## 输出格式

```markdown
## 代码审查报告

### P0 - 必须修复（阻塞发布）
- [文件:行号] 问题描述 → 修复建议
- [文件:行号] 问题描述 → 修复建议

### P1 - 建议修复（影响质量）
- [文件:行号] 问题描述 → 修复建议

### P2 - 可选优化（锦上添花）
- [文件:行号] 问题描述 → 优化建议

### 设计模式建议
- 场景描述 → 推荐模式

### 总结
- 代码质量评分：X/10
- 主要问题：XXX
- 改进重点：XXX
```

---

## 审查检查项清单

### 代码风格
- [ ] 命名是否规范（camelCase/PascalCase）
- [ ] 是否有注释掉的代码
- [ ] 是否有 console.log 调试代码
- [ ] 缩进和格式是否一致

### 类型安全
- [ ] 是否有 any 类型
- [ ] 是否有类型断言滥用
- [ ] 泛型使用是否合理

### 错误处理
- [ ] 是否有未处理的 Promise
- [ ] 异常是否被正确捕获
- [ ] 错误信息是否有意义

### 性能
- [ ] 是否有不必要的循环
- [ ] 是否有重复计算
- [ ] 数据库查询是否优化
